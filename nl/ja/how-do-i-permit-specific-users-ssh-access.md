---
copyright:
  years: 2014, 2018
lastupdated: "2018-02-23"
---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# ユーザーへの SSH アクセス権限の付与 

1 人以上のユーザーに SSH アクセス権限を付与するには、以下のステップを実行してください。 これらのステップは、以下のファイルの構成方法を示します。

1. 以下の OpenSSH ファイルを見つけます。
```
/etc/ssh/sshd_config
```
  
2. 必要な場合に戻せるように、このファイルのバックアップを作成します。 以下に例を示します。
```
cp /etc/ssh/sshd_config{,.'date +%s'}
```
  
3. OpenSSH キーワードを使用してファイルを編集します。


## OpenSSH キーワード

### AllowGroups 

このキーワードの後にグループ名パターンのリストを含めます。 複数のパターンはスペースで区切ります。 **ログイン**を指定する場合、1 次グループまたは補足グループのリストがこれらのパターンのいずれかに一致するユーザーにのみログインが許可されます。 パターンのワイルドカードとして`「*」および「?」`を使用できます。 グループ名のみが有効であり、数値グループ ID は認識されません。 デフォルトでは、すべてのグループに**ログイン**が許可されます。

### AllowUsers 

このキーワードの後にユーザー名パターンのリストを含めます。 複数のパターンはスペースで区切ります。 **ログイン**を指定すると、これらのパターンのいずれかに一致するユーザー名に対してのみログインが許可されます。 パターンのワイルドカードとして`「*」および「?」`を使用できます。 ユーザー名のみが有効であり、数値ユーザー ID は認識されません。 デフォルトでは、すべてのユーザーに**ログイン**が許可されます。 パターンが USER@HOST の形式を取る場合は、USER と HOST は別々に検査され、特定のホストからの特定のユーザーにログインを制限します。

### DenyGroups 

このキーワードの後にグループ名パターンのリストを含めます。 複数のパターンはスペースで区切ります。 **ログイン**を指定する場合、1 次グループまたは補足グループのリストがこれらのパターンのいずれかに一致するユーザーに対してログインが不許可になります。 `「*」および「?」`をパターンのワイルドカードとして使用できます。 グループ名のみが有効であり、数値グループ ID は認識されません。 デフォルトでは、すべてのグループに**ログイン**が許可されます。

### DenyUsers 

このキーワードの後にユーザー名パターンのリストを含めます。 複数のパターンはスペースで区切ります。 **ログイン**を指定すると、これらのパターンのいずれかに一致するユーザー名に対してログインが不許可になります。 パターンのワイルドカードとして `「*」および「?」`を使用できます。 ユーザー名のみが有効であり、数値ユーザー ID は認識されません。 デフォルトでは、すべてのユーザーに**ログイン**が許可されます。  パターンが USER@HOST の形式を取る場合は、USER と HOST は別々に検査され、特定のホストからの特定のユーザーにログインを制限します。

## 例

以下の例では、2 人の特定のユーザー、`admin` と `user1` のみがサーバーへのログインを許可されます。
**注:** キーワード `DenyGroups` および `DenyUsers` を使用して、同様の方法でグループを拒否することができます。
```
AllowUsers admin user1
```

将来のユーザー数の拡大に備えて、サーバーにログインできるグループをサーバー上に作成することができます。 必要に応じて個々のユーザーを追加できます (*`username`* を実際のユーザーに置き換えます)。

1. シェルで、以下のように sshusers などのユーザー・グループを追加します。
```
groupadd –r sshusers
```

2. シェルで、以下のようにグループにユーザーを追加します。
```
usermod –a –G sshusers admin
```
```
usermod -a -G sshusers user1
```

3. sshd_config ファイルで、以下のように sshusers グループにアクセス権限を付与します。
```
AllowGroups sshusers
```

4. 以下のようにして、sshd が中断せずに新しい構成を読み取ることを確認します。
```
/usr/sbin/sshd –t
```

```
echo $?
```

  `echo $?` コマンドの後に `0` が表示される場合、新しい構成は正しく設定されています。

  また、以下の例のようなエラー・メッセージを受け取ることもあります。
```
sshd_config: line 112: Bad configuration option: allowuser
```

```
sshd_config: terminating, 1 bad configuration options
```

5. すべてのエラーを修正し、正しい構成が設定されたら、sshd を再始動します。 sysv 互換システムのサンプル・コマンドは次のようになります: /etc/init.d/sshd restart

既存のセッションを切断せずに新しい SSH セッションを作成するようにしてください。 追加したユーザーですべてのアクションを実行できることを確認してください。
